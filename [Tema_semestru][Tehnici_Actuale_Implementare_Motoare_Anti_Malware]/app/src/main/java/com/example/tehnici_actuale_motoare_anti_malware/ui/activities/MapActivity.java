package com.example.tehnici_actuale_motoare_anti_malware.ui.activities;

import android.os.Bundle;
import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;

import com.example.tehnici_actuale_motoare_anti_malware.R;
import com.example.tehnici_actuale_motoare_anti_malware.data.local.model.Threat;
import com.example.tehnici_actuale_motoare_anti_malware.data.repository.ThreatRepositoryImpl;
import com.example.tehnici_actuale_motoare_anti_malware.domain.usecase.GetThreatsUseCase;
import com.google.android.gms.maps.CameraUpdateFactory;
import com.google.android.gms.maps.GoogleMap;
import com.google.android.gms.maps.OnMapReadyCallback;
import com.google.android.gms.maps.SupportMapFragment;
import com.google.android.gms.maps.model.LatLng;
import com.google.android.gms.maps.model.MarkerOptions;

import java.util.List;

public class MapActivity extends AppCompatActivity implements OnMapReadyCallback {
    private GoogleMap map;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_map);

        SupportMapFragment frag = (SupportMapFragment)
                getSupportFragmentManager().findFragmentById(R.id.mapFragment);
        frag.getMapAsync(this);
    }

    @Override
    public void onMapReady(@NonNull GoogleMap googleMap) {
        this.map = googleMap;
        // center on a default location
        LatLng center = new LatLng(44.43, 26.10);
        map.moveCamera(CameraUpdateFactory.newLatLngZoom(center, 10f));

        // add markers for each threat
        List<Threat> threats = new GetThreatsUseCase(
                new ThreatRepositoryImpl(this)).execute();

        for (Threat t : threats) {
            LatLng pos = new LatLng(t.getLatitude(), t.getLongitude());
            map.addMarker(new MarkerOptions()
                    .position(pos)
                    .title(t.getName() + " (sev " + t.getSeverity() + ")"));
        }
    }
}
