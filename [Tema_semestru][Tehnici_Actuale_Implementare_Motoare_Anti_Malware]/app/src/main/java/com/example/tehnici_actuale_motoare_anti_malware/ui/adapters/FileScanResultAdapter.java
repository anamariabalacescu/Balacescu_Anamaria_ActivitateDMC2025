package com.example.tehnici_actuale_motoare_anti_malware.ui.adapters;

import android.content.Context;
import android.graphics.Color;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ArrayAdapter;
import android.widget.TextView;
import com.example.tehnici_actuale_motoare_anti_malware.R;
import com.example.tehnici_actuale_motoare_anti_malware.data.local.model.FileScanResult;
import com.example.tehnici_actuale_motoare_anti_malware.data.local.model.Threat;

import java.util.List;

public class FileScanResultAdapter extends ArrayAdapter<FileScanResult> {
    private final LayoutInflater inflater;

    public FileScanResultAdapter(Context context, List<FileScanResult> items) {
        super(context, 0, items);
        inflater = LayoutInflater.from(context);
    }

    @Override
    public View getView(int pos, View convertView, ViewGroup parent) {
        if (convertView == null) {
            convertView = inflater.inflate(R.layout.item_file_result, parent, false);
        }

        FileScanResult res = getItem(pos);
        TextView tvFile    = convertView.findViewById(R.id.tvFileName);
        TextView tvResult  = convertView.findViewById(R.id.tvScanResult);
        TextView tvDetails = convertView.findViewById(R.id.tvScanDetails);

        tvFile.setText(res.getFileName());

        switch (res.getScanType()) {
            case FAST:
                // Red if corrupted, green otherwise
                boolean bad = res.isCorrupted();
                tvResult.setText(bad ? "Corrupted" : "OK");
                tvResult.setTextColor(bad ? Color.RED : Color.GREEN);
                tvDetails.setVisibility(View.GONE);
                break;

            case INTENSIVE:
                tvResult.setText("Threats found: " + res.getThreats().size());
                tvResult.setTextColor(Color.BLACK);
                // join threat names
                StringBuilder sb = new StringBuilder();
                for (Threat t : res.getThreats()) {
                    sb.append(t.getName())
                            .append(" (sev ")
                            .append(t.getSeverity())
                            .append(")\n");
                }
                tvDetails.setText(sb.toString().trim());
                tvDetails.setVisibility(View.VISIBLE);
                break;

            case VIRUSTOTAL:
                tvResult.setText("VirusTotal summary");
                tvResult.setTextColor(Color.BLACK);
                tvDetails.setText(res.getVtSummary());
                tvDetails.setVisibility(View.VISIBLE);
                break;
        }
        return convertView;
    }
}
